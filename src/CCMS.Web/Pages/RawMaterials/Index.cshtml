@page
@model CCMS.Web.Pages.RawMaterials.IndexModel
@{ ViewBag.Title = "Raw Materials"; }
<div class='card'>
  <div class='card-header d-flex justify-content-between align-items-center'>
    <h5 class='m-0'>@ViewBag.Title</h5>
    <button class='btn btn-primary' data-bs-toggle='modal' data-bs-target='#CreateModal'>Create</button>
  </div>
  <div class='card-body'>
    <table class='table table-hover align-middle'>
      <thead class='table-light'>
        <tr><th>Name</th><th>SKU</th><th>Unit</th><th>Qty</th><th>Reorder</th><th>Price</th><th>Supplier</th><th>Store</th><th style='width:160px;'></th></tr>
      </thead>
      <tbody>
      @if (Model?.Items != null && Model.Items.Any()) {
        foreach (var m in Model.Items) {
          var storeName = Model.StoreLookup.TryGetValue(m.StoreId, out var sn) ? sn : m.StoreId.ToString();
          <tr><td>@m.Name</td><td>@m.SKU</td><td>@m.Unit</td><td>@m.Quantity</td><td>@m.ReorderLevel</td><td>@m.Price</td><td>@m.SupplierName</td><td>@storeName</td>
          <td class='text-end'><button class='btn btn-sm btn-secondary' data-bs-toggle='modal' data-bs-target='#Edit-@m.Id'>Edit</button>
          <form method='post' asp-page-handler='Delete' class='d-inline'><input type='hidden' name='Id' value='@m.Id' /><button class='btn btn-sm btn-danger' type='submit'>Delete</button></form></td></tr>
          <partial name='Partials/_EditModal' model='m' />
        }}
      else {<tr><td colspan='9' class='text-center text-muted'>No materials found.</td></tr>}
      </tbody>
    </table>
  </div>
</div>
<div class='modal fade' id='CreateModal' tabindex='-1' aria-hidden='true'>
  <div class='modal-dialog'><div class='modal-content'>
    <form method='post' asp-page-handler='Create'>
      <div class='modal-header'><h5 class='modal-title'>Create Material</h5><button type='button' class='btn-close' data-bs-dismiss='modal'></button></div>
      <div class='modal-body'>
        <div class='mb-3'><label class='form-label'>Name</label><input class='form-control' name='Name' required /></div>
        <div class='mb-3'><label class='form-label'>SKU</label><input class='form-control' name='SKU' required /></div>
        <div class='mb-3'><label class='form-label'>Unit</label><input class='form-control' name='Unit' required /></div>
        <div class='mb-3'><label class='form-label'>Quantity</label><input type='number' step='1' class='form-control' name='Quantity' required /></div>
        <div class='mb-3'><label class='form-label'>Reorder Level</label><input type='number' step='1' class='form-control' name='ReorderLevel' /></div>
        <div class='mb-3'><label class='form-label'>Price</label><input type='number' step='0.01' class='form-control' name='Price' /></div>
        <div class='mb-3'><label class='form-label'>Supplier</label><input class='form-control' name='SupplierName' /></div>
        <div class='mb-3'><label class='form-label'>Store</label><select class='form-select' name='StoreId' required><option value='' disabled selected>Choose store...</option>
          @foreach (var s in Model.Stores){<option value='@s.Id'>@s.Name</option>}</select></div>
      </div>
      <div class='modal-footer'><button class='btn btn-light' data-bs-dismiss='modal' type='button'>Cancel</button><button class='btn btn-primary' type='submit'>Save</button></div>
    </form>
  </div></div>
</div>
